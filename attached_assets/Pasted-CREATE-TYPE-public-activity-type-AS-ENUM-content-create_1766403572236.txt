CREATE TYPE "public"."activity_type" AS ENUM('content_created', 'content_updated', 'content_published', 'content_deleted', 'comment_added', 'workflow_submitted', 'workflow_approved', 'workflow_rejected', 'user_joined', 'user_updated', 'team_created', 'translation_completed', 'media_uploaded', 'settings_changed', 'login', 'logout');
CREATE TYPE "public"."image_rating" AS ENUM('like', 'dislike', 'skip');
CREATE TYPE "public"."image_source" AS ENUM('gemini', 'openai', 'freepik', 'stock', 'upload');
CREATE TYPE "public"."notification_type" AS ENUM('info', 'success', 'warning', 'error', 'workflow_pending', 'workflow_approved', 'workflow_rejected', 'comment_mention', 'comment_reply', 'content_assigned', 'system');
CREATE TYPE "public"."topic_category" AS ENUM('luxury_lifestyle', 'food_dining', 'bizarre_unique', 'experiences_activities', 'money_cost', 'expat_living', 'dark_side', 'myth_busting', 'comparisons', 'records_superlatives', 'future_development', 'seasonal_events', 'practical_tips');
CREATE TYPE "public"."topic_cluster_status" AS ENUM('pending', 'merged', 'dismissed');
CREATE TYPE "public"."topic_format" AS ENUM('video_tour', 'photo_gallery', 'pov_video', 'cost_breakdown', 'lifestyle_vlog', 'documentary', 'explainer', 'comparison', 'walking_tour', 'food_tour', 'interview', 'tutorial', 'asmr', 'drone_footage', 'night_photography', 'infographic', 'reaction_video', 'challenge', 'list_video', 'guide', 'review');
CREATE TYPE "public"."topic_type" AS ENUM('trending', 'evergreen', 'seasonal');
CREATE TYPE "public"."viral_potential" AS ENUM('1', '2', '3', '4', '5');
CREATE TYPE "public"."webhook_event" AS ENUM('content.created', 'content.updated', 'content.published', 'content.deleted', 'user.created', 'user.updated', 'translation.completed', 'workflow.submitted', 'workflow.approved', 'workflow.rejected', 'comment.created', 'media.uploaded');
CREATE TYPE "public"."workflow_status" AS ENUM('pending', 'in_progress', 'approved', 'rejected', 'cancelled');
ALTER TYPE "public"."audit_action_type" ADD VALUE 'restore';
ALTER TYPE "public"."audit_entity_type" ADD VALUE 'tag';
ALTER TYPE "public"."audit_entity_type" ADD VALUE 'cluster';
ALTER TYPE "public"."audit_entity_type" ADD VALUE 'campaign';
ALTER TYPE "public"."audit_entity_type" ADD VALUE 'newsletter_subscriber';
ALTER TYPE "public"."content_type" ADD VALUE 'landing_page';
ALTER TYPE "public"."content_type" ADD VALUE 'case_study';
ALTER TYPE "public"."content_type" ADD VALUE 'off_plan';
CREATE TABLE "topic_clusters" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"topic" text NOT NULL,
	"status" "topic_cluster_status" DEFAULT 'pending' NOT NULL,
	"merged_content_id" varchar,
	"similarity_score" integer,
	"article_count" integer DEFAULT 0,
	"created_at" timestamp DEFAULT now(),
	"updated_at" timestamp DEFAULT now()
);
CREATE TABLE "activities" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"type" "activity_type" NOT NULL,
	"actor_id" varchar,
	"target_type" varchar(50),
	"target_id" varchar,
	"target_title" text,
	"metadata" jsonb,
	"team_id" varchar,
	"is_public" boolean DEFAULT true,
	"created_at" timestamp DEFAULT now()
);
CREATE TABLE "notifications" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" varchar NOT NULL,
	"type" "notification_type" DEFAULT 'info',
	"title" text NOT NULL,
	"message" text,
	"link" text,
	"metadata" jsonb,
	"is_read" boolean DEFAULT false,
	"read_at" timestamp,
	"created_at" timestamp DEFAULT now()
);
CREATE TABLE "webhook_logs" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"webhook_id" varchar NOT NULL,
	"event" text NOT NULL,
	"payload" jsonb,
	"response_status" integer,
	"response_body" text,
	"error" text,
	"duration" integer,
	"created_at" timestamp DEFAULT now()
);
CREATE TABLE "topic_cluster_items" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"cluster_id" varchar NOT NULL,
	"content_id" varchar,
	"rss_feed_id" varchar,
	"source_url" text,
	"source_title" text NOT NULL,
	"source_description" text,
	"pub_date" timestamp,
	"is_used_in_merge" boolean DEFAULT false,
	"created_at" timestamp DEFAULT now()
);
CREATE TABLE "image_collections" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"cover_image_id" varchar,
	"image_ids" jsonb DEFAULT '[]'::jsonb,
	"created_at" timestamp DEFAULT now(),
	"updated_at" timestamp DEFAULT now()
);
CREATE TABLE "content_locks" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"content_id" varchar NOT NULL,
	"user_id" varchar NOT NULL,
	"locked_at" timestamp DEFAULT now(),
	"expires_at" timestamp NOT NULL,
	"is_active" boolean DEFAULT true
);
CREATE TABLE "team_members" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"team_id" varchar NOT NULL,
	"user_id" varchar NOT NULL,
	"role" varchar(50) DEFAULT 'member',
	"joined_at" timestamp DEFAULT now()
);
CREATE TABLE "ai_generated_images" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"filename" text NOT NULL,
	"url" text NOT NULL,
	"topic" text NOT NULL,
	"category" text,
	"image_type" text,
	"source" "image_source" DEFAULT 'openai',
	"prompt" text,
	"keywords" jsonb DEFAULT '[]'::jsonb,
	"alt_text" text,
	"alt_text_he" text,
	"caption" text,
	"caption_he" text,
	"ai_quality_score" integer,
	"user_rating" "image_rating",
	"width" integer,
	"height" integer,
	"size" integer,
	"is_approved" boolean DEFAULT false,
	"usage_count" integer DEFAULT 0,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp DEFAULT now(),
	"updated_at" timestamp DEFAULT now()
);
CREATE TABLE "webhooks" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"url" text NOT NULL,
	"secret" text,
	"events" jsonb DEFAULT '[]'::jsonb,
	"headers" jsonb,
	"is_active" boolean DEFAULT true,
	"created_by" varchar,
	"created_at" timestamp DEFAULT now(),
	"updated_at" timestamp DEFAULT now()
);
CREATE TABLE "ui_translations" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"key" text NOT NULL,
	"locale" "locale" NOT NULL,
	"value" text NOT NULL,
	"namespace" varchar DEFAULT 'common',
	"is_manual_override" boolean DEFAULT false,
	"created_at" timestamp DEFAULT now(),
	"updated_at" timestamp DEFAULT now()
);
CREATE TABLE "workflow_templates" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"content_types" jsonb DEFAULT '[]'::jsonb,
	"steps" jsonb DEFAULT '[]'::jsonb,
	"is_default" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_by" varchar,
	"created_at" timestamp DEFAULT now(),
	"updated_at" timestamp DEFAULT now()
);
CREATE TABLE "content_rules" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" varchar NOT NULL,
	"description" text,
	"is_active" boolean DEFAULT true NOT NULL,
	"min_words" integer DEFAULT 1800 NOT NULL,
	"max_words" integer DEFAULT 3500 NOT NULL,
	"optimal_min_words" integer DEFAULT 2000 NOT NULL,
	"optimal_max_words" integer DEFAULT 2500 NOT NULL,
	"intro_min_words" integer DEFAULT 150 NOT NULL,
	"intro_max_words" integer DEFAULT 200 NOT NULL,
	"quick_facts_min" integer DEFAULT 5 NOT NULL,
	"quick_facts_max" integer DEFAULT 8 NOT NULL,
	"quick_facts_words_min" integer DEFAULT 80 NOT NULL,
	"quick_facts_words_max" integer DEFAULT 120 NOT NULL,
	"main_sections_min" integer DEFAULT 4 NOT NULL,
	"main_sections_max" integer DEFAULT 6 NOT NULL,
	"main_section_words_min" integer DEFAULT 200 NOT NULL,
	"main_section_words_max" integer DEFAULT 300 NOT NULL,
	"faqs_min" integer DEFAULT 6 NOT NULL,
	"faqs_max" integer DEFAULT 10 NOT NULL,
	"faq_answer_words_min" integer DEFAULT 50 NOT NULL,
	"faq_answer_words_max" integer DEFAULT 100 NOT NULL,
	"pro_tips_min" integer DEFAULT 5 NOT NULL,
	"pro_tips_max" integer DEFAULT 8 NOT NULL,
	"pro_tip_words_min" integer DEFAULT 20 NOT NULL,
	"pro_tip_words_max" integer DEFAULT 35 NOT NULL,
	"conclusion_min_words" integer DEFAULT 100 NOT NULL,
	"conclusion_max_words" integer DEFAULT 150 NOT NULL,
	"internal_links_min" integer DEFAULT 5 NOT NULL,
	"internal_links_max" integer DEFAULT 10 NOT NULL,
	"keyword_density_min" integer DEFAULT 1 NOT NULL,
	"keyword_density_max" integer DEFAULT 3 NOT NULL,
	"dubai_mentions_min" integer DEFAULT 5 NOT NULL,
	"max_retries" integer DEFAULT 3 NOT NULL,
	"content_type" "content_type",
	"created_by" varchar,
	"created_at" timestamp DEFAULT now(),
	"updated_at" timestamp DEFAULT now(),
	CONSTRAINT "content_rules_name_unique" UNIQUE("name")
);
CREATE TABLE "teams" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"slug" text NOT NULL,
	"description" text,
	"parent_id" varchar,
	"color" varchar(7),
	"icon" varchar(50),
	"is_active" boolean DEFAULT true,
	"created_at" timestamp DEFAULT now(),
	"updated_at" timestamp DEFAULT now(),
	CONSTRAINT "teams_slug_unique" UNIQUE("slug")
);
CREATE TABLE "workflow_approvals" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"instance_id" varchar NOT NULL,
	"step_number" integer NOT NULL,
	"approver_id" varchar,
	"status" "workflow_status" DEFAULT 'pending',
	"comment" text,
	"decided_at" timestamp,
	"created_at" timestamp DEFAULT now()
);
CREATE TABLE "workflow_instances" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"template_id" varchar,
	"content_id" varchar NOT NULL,
	"status" "workflow_status" DEFAULT 'pending',
	"current_step" integer DEFAULT 0,
	"submitted_by" varchar,
	"submitted_at" timestamp DEFAULT now(),
	"completed_at" timestamp,
	"metadata" jsonb
);
CREATE TABLE "comments" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"content_id" varchar NOT NULL,
	"parent_id" varchar,
	"author_id" varchar NOT NULL,
	"body" text NOT NULL,
	"mentions" jsonb DEFAULT '[]'::jsonb,
	"is_resolved" boolean DEFAULT false,
	"resolved_by" varchar,
	"resolved_at" timestamp,
	"edited_at" timestamp,
	"created_at" timestamp DEFAULT now()
);
CREATE TABLE "scheduled_tasks" (
	"id" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"type" varchar(50) NOT NULL,
	"target_type" varchar(50) NOT NULL,
	"target_id" varchar NOT NULL,
	"scheduled_for" timestamp NOT NULL,
	"payload" jsonb,
	"status" varchar(20) DEFAULT 'pending',
	"error" text,
	"created_by" varchar,
	"executed_at" timestamp,
	"created_at" timestamp DEFAULT now()
);
ALTER TABLE "telegram_user_favorites" DISABLE ROW LEVEL SECURITY;
DROP TABLE "telegram_user_favorites" CASCADE;
ALTER TABLE "content_tags" DROP CONSTRAINT "content_tags_content_id_tag_id_key";
ALTER TABLE "cluster_members" DROP CONSTRAINT "cluster_members_cluster_id_content_id_key";
ALTER TABLE "site_settings" DROP CONSTRAINT "site_settings_key_key";
ALTER TABLE "content_clusters" DROP CONSTRAINT "content_clusters_slug_key";
ALTER TABLE "seo_analysis_results" DROP CONSTRAINT "seo_analysis_results_content_id_key";
ALTER TABLE "tags" DROP CONSTRAINT "tags_slug_key";
ALTER TABLE "newsletter_subscribers" DROP CONSTRAINT "newsletter_subscribers_email_key";
ALTER TABLE "users" DROP CONSTRAINT "users_email_key";
ALTER TABLE "users" DROP CONSTRAINT "users_username_key";
ALTER TABLE "telegram_user_profiles" DROP CONSTRAINT "telegram_user_profiles_telegram_id_key";
ALTER TABLE "content_tags" DROP CONSTRAINT "content_tags_content_id_fkey";
ALTER TABLE "content_tags" DROP CONSTRAINT "content_tags_tag_id_fkey";
ALTER TABLE "cluster_members" DROP CONSTRAINT "cluster_members_cluster_id_fkey";
ALTER TABLE "cluster_members" DROP CONSTRAINT "cluster_members_content_id_fkey";
ALTER TABLE "audit_logs" DROP CONSTRAINT "audit_logs_user_id_fkey";
ALTER TABLE "telegram_conversations" DROP CONSTRAINT "telegram_conversations_telegram_user_id_fkey";
ALTER TABLE "content_views" DROP CONSTRAINT "content_views_content_id_fkey";
ALTER TABLE "content_clusters" DROP CONSTRAINT "content_clusters_pillar_content_id_fkey";
ALTER TABLE "homepage_promotions" DROP CONSTRAINT "homepage_promotions_content_id_fkey";
ALTER TABLE "seo_analysis_results" DROP CONSTRAINT "seo_analysis_results_content_id_fkey";
ALTER TABLE "campaign_events" DROP CONSTRAINT "campaign_events_campaign_id_fkey";
ALTER TABLE "campaign_events" DROP CONSTRAINT "campaign_events_subscriber_id_fkey";
ALTER TABLE "newsletter_campaigns" DROP CONSTRAINT "newsletter_campaigns_created_by_fkey";
ALTER TABLE "contents" DROP CONSTRAINT "contents_author_id_fkey";
ALTER TABLE "ui_translations" ALTER COLUMN "locale" SET DATA TYPE text;
ALTER TABLE "translations" ALTER COLUMN "locale" SET DATA TYPE text;
DROP TYPE "public"."locale";
CREATE TYPE "public"."locale" AS ENUM('en', 'ar', 'hi', 'zh', 'ru', 'ur', 'fr', 'de', 'fa', 'bn', 'fil', 'es', 'tr', 'it', 'ja', 'ko', 'he');
ALTER TABLE "ui_translations" ALTER COLUMN "locale" SET DATA TYPE "public"."locale" USING "locale"::"public"."locale";
ALTER TABLE "translations" ALTER COLUMN "locale" SET DATA TYPE "public"."locale" USING "locale"::"public"."locale";
ALTER TABLE "users" ALTER COLUMN "role" SET DATA TYPE text;
ALTER TABLE "users" ALTER COLUMN "role" SET DEFAULT 'editor'::text;
DROP TYPE "public"."user_role";
CREATE TYPE "public"."user_role" AS ENUM('admin', 'editor', 'author', 'contributor', 'viewer');
ALTER TABLE "users" ALTER COLUMN "role" SET DEFAULT 'editor'::"public"."user_role";
ALTER TABLE "users" ALTER COLUMN "role" SET DATA TYPE "public"."user_role" USING "role"::"public"."user_role";
DROP INDEX "idx_session_expire";
DROP INDEX "idx_otp_codes_email_code";
ALTER TABLE "sessions" ALTER COLUMN "sid" SET DATA TYPE varchar;
ALTER TABLE "sessions" ALTER COLUMN "sess" SET DATA TYPE jsonb;
ALTER TABLE "sessions" ALTER COLUMN "expire" SET DATA TYPE timestamp;
ALTER TABLE "telegram_conversations" ALTER COLUMN "telegram_user_id" DROP NOT NULL;
ALTER TABLE "telegram_conversations" ALTER COLUMN "role" DROP NOT NULL;
ALTER TABLE "telegram_conversations" ALTER COLUMN "content" DROP NOT NULL;
ALTER TABLE "site_settings" ALTER COLUMN "key" SET DATA TYPE varchar;
ALTER TABLE "otp_codes" ALTER COLUMN "email" SET DATA TYPE varchar;
ALTER TABLE "tags" ALTER COLUMN "color" SET DATA TYPE varchar;
ALTER TABLE "users" ALTER COLUMN "email" SET DATA TYPE varchar;
ALTER TABLE "users" ALTER COLUMN "email" DROP NOT NULL;
ALTER TABLE "users" ALTER COLUMN "name" SET DATA TYPE varchar;
ALTER TABLE "users" ALTER COLUMN "first_name" SET DATA TYPE varchar;
ALTER TABLE "users" ALTER COLUMN "last_name" SET DATA TYPE varchar;
ALTER TABLE "users" ALTER COLUMN "profile_image_url" SET DATA TYPE varchar;
ALTER TABLE "users" ALTER COLUMN "updated_at" SET DEFAULT now();
ALTER TABLE "telegram_user_profiles" ALTER COLUMN "language" SET DATA TYPE varchar;
ALTER TABLE "telegram_user_profiles" ALTER COLUMN "language" DROP DEFAULT;
ALTER TABLE "telegram_user_profiles" ALTER COLUMN "language" DROP NOT NULL;
ALTER TABLE "telegram_user_profiles" ALTER COLUMN "last_active_at" DROP DEFAULT;
ALTER TABLE "property_leads" ALTER COLUMN "status" SET DEFAULT 'new'::"public"."lead_status";
ALTER TABLE "property_leads" ALTER COLUMN "status" SET DATA TYPE "public"."lead_status" USING "status"::"public"."lead_status";
ALTER TABLE "content_templates" ADD COLUMN "extension_defaults" jsonb;
ALTER TABLE "content_templates" ADD COLUMN "seo_defaults" jsonb;
ALTER TABLE "content_templates" ADD COLUMN "is_public" boolean DEFAULT false;
ALTER TABLE "content_templates" ADD COLUMN "usage_count" integer DEFAULT 0;
ALTER TABLE "content_templates" ADD COLUMN "created_by" varchar;
ALTER TABLE "site_settings" ADD COLUMN "category" varchar NOT NULL;
ALTER TABLE "site_settings" ADD COLUMN "updated_by" varchar;
ALTER TABLE "seo_analysis_results" ADD COLUMN "overall_score" integer NOT NULL;
ALTER TABLE "seo_analysis_results" ADD COLUMN "title_score" integer;
ALTER TABLE "seo_analysis_results" ADD COLUMN "meta_description_score" integer;
ALTER TABLE "seo_analysis_results" ADD COLUMN "keyword_score" integer;
ALTER TABLE "seo_analysis_results" ADD COLUMN "content_score" integer;
ALTER TABLE "seo_analysis_results" ADD COLUMN "readability_score" integer;
ALTER TABLE "seo_analysis_results" ADD COLUMN "technical_score" integer;
ALTER TABLE "topic_bank" ADD COLUMN "headline_angle" text;
ALTER TABLE "topic_bank" ADD COLUMN "main_category" "topic_category";
ALTER TABLE "topic_bank" ADD COLUMN "viral_potential" "viral_potential" DEFAULT '3';
ALTER TABLE "topic_bank" ADD COLUMN "format" "topic_format";
ALTER TABLE "topic_bank" ADD COLUMN "topic_type" "topic_type" DEFAULT 'evergreen';
ALTER TABLE "translations" ADD COLUMN "source_hash" varchar;
ALTER TABLE "translations" ADD COLUMN "is_manual_override" boolean DEFAULT false;
ALTER TABLE "translations" ADD COLUMN "translation_provider" varchar;
ALTER TABLE "topic_clusters" ADD CONSTRAINT "topic_clusters_merged_content_id_contents_id_fk" FOREIGN KEY ("merged_content_id") REFERENCES "public"."contents"("id") ON DELETE set null ON UPDATE no action;
ALTER TABLE "activities" ADD CONSTRAINT "activities_actor_id_users_id_fk" FOREIGN KEY ("actor_id") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "activities" ADD CONSTRAINT "activities_team_id_teams_id_fk" FOREIGN KEY ("team_id") REFERENCES "public"."teams"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "notifications" ADD CONSTRAINT "notifications_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "webhook_logs" ADD CONSTRAINT "webhook_logs_webhook_id_webhooks_id_fk" FOREIGN KEY ("webhook_id") REFERENCES "public"."webhooks"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "topic_cluster_items" ADD CONSTRAINT "topic_cluster_items_cluster_id_topic_clusters_id_fk" FOREIGN KEY ("cluster_id") REFERENCES "public"."topic_clusters"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "topic_cluster_items" ADD CONSTRAINT "topic_cluster_items_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "topic_cluster_items" ADD CONSTRAINT "topic_cluster_items_rss_feed_id_rss_feeds_id_fk" FOREIGN KEY ("rss_feed_id") REFERENCES "public"."rss_feeds"("id") ON DELETE set null ON UPDATE no action;
ALTER TABLE "content_locks" ADD CONSTRAINT "content_locks_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "content_locks" ADD CONSTRAINT "content_locks_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "team_members" ADD CONSTRAINT "team_members_team_id_teams_id_fk" FOREIGN KEY ("team_id") REFERENCES "public"."teams"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "team_members" ADD CONSTRAINT "team_members_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "webhooks" ADD CONSTRAINT "webhooks_created_by_users_id_fk" FOREIGN KEY ("created_by") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "workflow_templates" ADD CONSTRAINT "workflow_templates_created_by_users_id_fk" FOREIGN KEY ("created_by") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "content_rules" ADD CONSTRAINT "content_rules_created_by_users_id_fk" FOREIGN KEY ("created_by") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "teams" ADD CONSTRAINT "teams_parent_id_teams_id_fk" FOREIGN KEY ("parent_id") REFERENCES "public"."teams"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "workflow_approvals" ADD CONSTRAINT "workflow_approvals_approver_id_users_id_fk" FOREIGN KEY ("approver_id") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "workflow_approvals" ADD CONSTRAINT "workflow_approvals_instance_id_workflow_instances_id_fk" FOREIGN KEY ("instance_id") REFERENCES "public"."workflow_instances"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "workflow_instances" ADD CONSTRAINT "workflow_instances_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "workflow_instances" ADD CONSTRAINT "workflow_instances_submitted_by_users_id_fk" FOREIGN KEY ("submitted_by") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "workflow_instances" ADD CONSTRAINT "workflow_instances_template_id_workflow_templates_id_fk" FOREIGN KEY ("template_id") REFERENCES "public"."workflow_templates"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "comments" ADD CONSTRAINT "comments_author_id_users_id_fk" FOREIGN KEY ("author_id") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "comments" ADD CONSTRAINT "comments_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "comments" ADD CONSTRAINT "comments_parent_id_comments_id_fk" FOREIGN KEY ("parent_id") REFERENCES "public"."comments"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "comments" ADD CONSTRAINT "comments_resolved_by_users_id_fk" FOREIGN KEY ("resolved_by") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "scheduled_tasks" ADD CONSTRAINT "scheduled_tasks_created_by_users_id_fk" FOREIGN KEY ("created_by") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
CREATE INDEX "IDX_activities_actor" ON "activities" USING btree ("actor_id");
CREATE INDEX "IDX_activities_created" ON "activities" USING btree ("created_at");
CREATE INDEX "IDX_activities_target" ON "activities" USING btree ("target_type","target_id");
CREATE INDEX "IDX_activities_team" ON "activities" USING btree ("team_id");
CREATE INDEX "IDX_notifications_created" ON "notifications" USING btree ("created_at");
CREATE INDEX "IDX_notifications_unread" ON "notifications" USING btree ("user_id","is_read");
CREATE INDEX "IDX_notifications_user" ON "notifications" USING btree ("user_id");
CREATE INDEX "IDX_webhook_logs_created" ON "webhook_logs" USING btree ("created_at");
CREATE INDEX "IDX_webhook_logs_webhook" ON "webhook_logs" USING btree ("webhook_id");
CREATE UNIQUE INDEX "IDX_content_locks_active" ON "content_locks" USING btree ("content_id") WHERE (is_active = true);
CREATE INDEX "IDX_content_locks_expires" ON "content_locks" USING btree ("expires_at");
CREATE INDEX "IDX_content_locks_user" ON "content_locks" USING btree ("user_id");
CREATE UNIQUE INDEX "IDX_team_members_unique" ON "team_members" USING btree ("team_id","user_id");
CREATE INDEX "IDX_team_members_user" ON "team_members" USING btree ("user_id");
CREATE INDEX "IDX_webhooks_active" ON "webhooks" USING btree ("is_active");
CREATE INDEX "IDX_teams_parent" ON "teams" USING btree ("parent_id");
CREATE INDEX "IDX_teams_slug" ON "teams" USING btree ("slug");
CREATE INDEX "IDX_workflow_approvals_approver" ON "workflow_approvals" USING btree ("approver_id");
CREATE INDEX "IDX_workflow_approvals_instance" ON "workflow_approvals" USING btree ("instance_id");
CREATE INDEX "IDX_workflow_instances_content" ON "workflow_instances" USING btree ("content_id");
CREATE INDEX "IDX_workflow_instances_status" ON "workflow_instances" USING btree ("status");
CREATE INDEX "IDX_comments_author" ON "comments" USING btree ("author_id");
CREATE INDEX "IDX_comments_content" ON "comments" USING btree ("content_id");
CREATE INDEX "IDX_comments_parent" ON "comments" USING btree ("parent_id");
CREATE INDEX "IDX_scheduled_tasks_pending" ON "scheduled_tasks" USING btree ("scheduled_for") WHERE ((status)::text = 'pending'::text);
CREATE INDEX "IDX_scheduled_tasks_target" ON "scheduled_tasks" USING btree ("target_type","target_id");
ALTER TABLE "content_tags" ADD CONSTRAINT "content_tags_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "content_tags" ADD CONSTRAINT "content_tags_tag_id_tags_id_fk" FOREIGN KEY ("tag_id") REFERENCES "public"."tags"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "cluster_members" ADD CONSTRAINT "cluster_members_cluster_id_content_clusters_id_fk" FOREIGN KEY ("cluster_id") REFERENCES "public"."content_clusters"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "cluster_members" ADD CONSTRAINT "cluster_members_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "content_templates" ADD CONSTRAINT "content_templates_created_by_users_id_fk" FOREIGN KEY ("created_by") REFERENCES "public"."users"("id") ON DELETE set null ON UPDATE no action;
ALTER TABLE "audit_logs" ADD CONSTRAINT "audit_logs_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE set null ON UPDATE no action;
ALTER TABLE "telegram_conversations" ADD CONSTRAINT "telegram_conversations_telegram_user_id_telegram_user_profiles_" FOREIGN KEY ("telegram_user_id") REFERENCES "public"."telegram_user_profiles"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "site_settings" ADD CONSTRAINT "site_settings_updated_by_users_id_fk" FOREIGN KEY ("updated_by") REFERENCES "public"."users"("id") ON DELETE set null ON UPDATE no action;
ALTER TABLE "content_views" ADD CONSTRAINT "content_views_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "content_clusters" ADD CONSTRAINT "content_clusters_pillar_content_id_contents_id_fk" FOREIGN KEY ("pillar_content_id") REFERENCES "public"."contents"("id") ON DELETE set null ON UPDATE no action;
ALTER TABLE "homepage_promotions" ADD CONSTRAINT "homepage_promotions_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "seo_analysis_results" ADD CONSTRAINT "seo_analysis_results_content_id_contents_id_fk" FOREIGN KEY ("content_id") REFERENCES "public"."contents"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "campaign_events" ADD CONSTRAINT "campaign_events_campaign_id_newsletter_campaigns_id_fk" FOREIGN KEY ("campaign_id") REFERENCES "public"."newsletter_campaigns"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "campaign_events" ADD CONSTRAINT "campaign_events_subscriber_id_newsletter_subscribers_id_fk" FOREIGN KEY ("subscriber_id") REFERENCES "public"."newsletter_subscribers"("id") ON DELETE set null ON UPDATE no action;
ALTER TABLE "newsletter_campaigns" ADD CONSTRAINT "newsletter_campaigns_created_by_users_id_fk" FOREIGN KEY ("created_by") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
ALTER TABLE "contents" ADD CONSTRAINT "contents_author_id_users_id_fk" FOREIGN KEY ("author_id") REFERENCES "public"."users"("id") ON DELETE no action ON UPDATE no action;
CREATE INDEX "IDX_content_tags_content" ON "content_tags" USING btree ("content_id");
CREATE INDEX "IDX_content_tags_tag" ON "content_tags" USING btree ("tag_id");
CREATE INDEX "IDX_cluster_members_cluster" ON "cluster_members" USING btree ("cluster_id");
CREATE INDEX "IDX_cluster_members_content" ON "cluster_members" USING btree ("content_id");
CREATE INDEX "IDX_session_expire" ON "sessions" USING btree ("expire");
CREATE INDEX "IDX_seo_analysis_content" ON "seo_analysis_results" USING btree ("content_id");
CREATE UNIQUE INDEX "IDX_translations_content_locale" ON "translations" USING btree ("content_id","locale");
CREATE INDEX "IDX_translations_locale" ON "translations" USING btree ("locale");
CREATE INDEX "IDX_translations_status" ON "translations" USING btree ("status");
CREATE INDEX "IDX_contents_author" ON "contents" USING btree ("author_id");
CREATE INDEX "IDX_contents_published_at" ON "contents" USING btree ("published_at");
CREATE INDEX "IDX_contents_status" ON "contents" USING btree ("status");
CREATE INDEX "IDX_contents_type" ON "contents" USING btree ("type");
CREATE INDEX "IDX_contents_type_status" ON "contents" USING btree ("type","status");
ALTER TABLE "content_templates" DROP COLUMN "default_seo_schema";
ALTER TABLE "content_templates" DROP COLUMN "is_active";
ALTER TABLE "seo_analysis_results" DROP COLUMN "score";
ALTER TABLE "site_settings" ADD CONSTRAINT "site_settings_key_unique" UNIQUE("key");
ALTER TABLE "content_clusters" ADD CONSTRAINT "content_clusters_slug_unique" UNIQUE("slug");
ALTER TABLE "tags" ADD CONSTRAINT "tags_name_unique" UNIQUE("name");
ALTER TABLE "tags" ADD CONSTRAINT "tags_slug_unique" UNIQUE("slug");
ALTER TABLE "newsletter_subscribers" ADD CONSTRAINT "newsletter_subscribers_email_unique" UNIQUE("email");
ALTER TABLE "users" ADD CONSTRAINT "users_email_unique" UNIQUE("email");
ALTER TABLE "users" ADD CONSTRAINT "users_username_unique" UNIQUE("username");
DROP TYPE "public"."telegram_bot_lang";
