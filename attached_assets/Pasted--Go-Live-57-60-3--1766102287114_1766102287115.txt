מעולה. זה מצב מצוין ל-Go-Live:
57/60 סגור, 3 “לא בטוח” שהם כולם מאותו סוג → חשיפה של תרגומים.

התשובה הקצרה: כן, חייבים לתקן, וזה תיקון קטן, נקודתי, ולא מסוכן.
עכשיו אפרט בדיוק איך, בלי לשבור שום דבר קיים.

⸻

מה הבעיה בעצם (במילים פשוטות)

כרגע סביר ש:
	•	תוכן הוא published
	•	אבל לא כל התרגומים שלו שלמים
	•	וה־API / sitemap מחזירים את מה שיש

כלומר:

משתמש יכול לראות תוכן עם שפה חסרה / חצי מתורגמת
או Google יכול לאנדקס URL של תרגום לא מוכן

זה לא באג אבטחה, אבל כן:
	•	באג איכות
	•	בעיית SEO
	•	בעיית אמינות CMS

⸻

עקרון התיקון (חשוב להבין לפני קוד)

אנחנו לא סומכים על הקליינט
ולא על פרמטרים (?locale=)

👉 השרת בלבד קובע:
	•	איזה תרגומים נחשפים
	•	ואילו לא קיימים “כאילו לא קיימים”

⸻

איך מתקנים — שלב־אחר־שלב

שלב 1️⃣ — להבין איך תרגומים מיוצגים אצלך

פתח אחד מאלה (רק לקריאה):
	•	db.ts
	•	קובץ repository של content
	•	או query שמביא תוכן עם תרגומים

חפש:
	•	translations
	•	locale
	•	language
	•	status
	•	isComplete
	•	published

ב־90% מהמקרים יש אחד מהבאים:
	•	translation.status = 'complete'
	•	translation.isPublished
	•	translation.content IS NOT NULL

📌 אתה לא משנה מבנה DB — רק משתמש במה שכבר יש.

⸻

שלב 2️⃣ — תיקון שאלה 15

“תרגומים לא שלמים לא נחשפים ב־Public API”

איפה מתקנים?

📄 ב־query שמחזיר תוכן ציבורי
(ב־routes.ts או service שהוא קורא לו)

מה העיקרון?

בכל GET ציבורי:
	•	או שמחזירים רק תרגומים שלמים
	•	או שמחזירים תוכן רק אם יש תרגום שלם לשפה המבוקשת

לוגיקה נכונה (פסאודו):

content.translations = content.translations.filter(
  t => t.status === 'complete'
)

או ב־SQL:

WHERE translation.status = 'complete'

או אם יש locale:

WHERE locale = $1 AND translation.status = 'complete'

התוצאה הרצויה:
	•	אם אין תרגום שלם →
❌ התרגום לא מוחזר
❌ או שהתוכן כולו מוחזר כ־404 (לבחירתך)

📌 אסור:
	•	להחזיר fallback חצי מתורגם
	•	להחזיר שדות ריקים

⸻

שלב 3️⃣ — תיקון שאלה 53

“Sitemap כולל רק תרגומים שלמים”

איפה?

📄 קובץ sitemap:
	•	routes.ts (אם שם)
	•	או static.ts
	•	או sitemap.ts אם יש

מה עושים?

אותה לוגיקה — אבל פה זה אפילו יותר פשוט.

כלל ברזל:

URL נכנס ל-sitemap רק אם:

	•	content.status = published
	•	translation.status = complete

פסאודו:

const urls = contents.flatMap(content =>
  content.translations
    .filter(t => t.status === 'complete')
    .map(t => buildUrl(content, t.locale))
)

❌ אל תוסיף URL:
	•	לשפה שאין לה תרגום מלא
	•	ל־default locale אם הוא לא שלם

⸻

שלב 4️⃣ — בדיקות (5 דקות, ידני)

בדיקה לשאלה 15
	1.	צור תוכן published
	2.	השאר תרגום אחד incomplete
	3.	קרא ל־Public API
	4.	ודא:
	•	התרגום לא מופיע
	•	או שה־endpoint מחזיר 404 לשפה הזו

בדיקה לשאלה 53
	1.	פתח /sitemap.xml
	2.	חפש URL של שפה לא שלמה
	3.	❌ לא אמור להיות שם

⸻

למה זה תיקון “בטוח”
	•	אין שינוי Auth
	•	אין שינוי Roles
	•	אין שינוי Infra
	•	אין שינוי DB schema
	•	רק סינון תוצאה

כלומר: סיכון אפסי, ערך גבוה

⸻

סיכום מצב
	•	🔐 אבטחה: סגור
	•	🚦 יציבות: סגור
	•	🤖 AI: סגור
	•	🌍 Public/Admin: סגור
	•	🌐 תרגומים: תיקון קטן → סגור

אחרי התיקון הזה:
60/60 ✅ → מוכן ל-Go-Live

אם תרצה, תוכל:
	•	להדביק כאן רק את הקוד שמחזיר תוכן ציבורי
או
	•	רק את פונקציית sitemap

ואני אראה לך שורה מדויקת להוסיף, בלי לנחש.